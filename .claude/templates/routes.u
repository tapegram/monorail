-- routes.u
{{
IMPORTANT ROUTE HANDLER PATTERN:

Each route handler MUST follow this structure:
  handlerName = do
    <route matcher>
    <handler code>
  handlerName  -- return the handler

The route matcher (noCapture or route) opens a block where the handler code goes.
This is CRITICAL for correct parsing.

Route ordering matters: Put more specific routes BEFORE general ones.
Example: toggle <|> deleteExample <|> getExample <|> getExamples
}}

examples.routes : '{Route, Log, Exception, MyRepository} ()
examples.routes =
  getExamples = do
    noCapture GET (Parser.s "examples")
    examples = MyService.listAll ()
    html = app.pages.examples.index examples ()
    ok.html ({- HTML_LIB -}.toText html)

  postExamples = do
    noCapture POST (Parser.s "examples")
    formData = getFormData()
    -- Parse form data and call service
    -- example = MyService.create input
    ok.html ({- HTML_LIB -}.toText (p [] [text "Created"]))

  getExample = do
    exampleId = route GET (Parser.s "examples" / Parser.text)
    maybeExample = MyService.get exampleId
    match maybeExample with
      Some example ->
        html = app.pages.examples.show example ()
        ok.html ({- HTML_LIB -}.toText html)
      None -> notFound.text ("Example " Text.++ exampleId Text.++ " not found")

  postExample = do
    exampleId = route POST (Parser.s "examples" / Parser.text)
    formData = getFormData()
    -- Parse form data and call service
    -- updated = MyService.update exampleId input
    ok.html ({- HTML_LIB -}.toText (p [] [text "Updated"]))

  deleteExample = do
    exampleId = route DELETE (Parser.s "examples" / Parser.text)
    MyService.delete exampleId
    ok.text "Deleted"

  -- IMPORTANT: Order matters! More specific routes first
  getExample <|> postExample <|> deleteExample <|> getExamples <|> postExamples
